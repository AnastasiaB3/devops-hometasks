Vagrant.configure("2") do |config|
  config.vm.box = "debian/bullseye64"
  config.vm.network "forwarded_port", guest: 80, host: 8080
  config.vm.network "forwarded_port", guest: 81, host: 8081

  config.vm.provision "shell", inline: <<-SHELL
    apt-get update
    apt-get install -y apache2 php libapache2-mod-php

    echo '<html><head><title>Success!</title></head><body>You Vagrantfile is fine if you can see this message.</body></html>' > /var/www/html/index.html

    echo '<?php \$limit = rand(1, 1000); for (\$i=0; \$i<\$limit; \$i++){ echo "<p>Hello, world!</p>"; } ?>' > /var/www/html/index.php

    a2enmod php7.4

 echo "Listen 81" | sudo tee -a /etc/apache2/ports.conf

 echo "
  <VirtualHost *:81>
      DocumentRoot /var/www/html
      DirectoryIndex index.php
      <Directory /var/www/html>
          Options Indexes FollowSymLinks MultiViews
          AllowOverride All
          Require all granted
      </Directory>
  </VirtualHost>" | sudo tee /etc/apache2/sites-available/8081.conf

sudo a2ensite 8081.conf

sudo systemctl restart apache2
  SHELL
end